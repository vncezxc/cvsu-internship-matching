{% extends 'dashboard/base_dashboard.html' %}
{% load file_extras %}
{% block dashboard_title %}All Students Document Completion Overview{% endblock %}
{% block dashboard_content %}
<div class="container mt-4">
    <h2>All Students Document Completion</h2>
    <div class="table-responsive">
        <table class="table table-bordered align-middle">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Course</th>
                    {% for doc in required_documents %}
                        <th>{{ doc.name }}</th>
                    {% endfor %}
                    <th>Progress</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in students_with_docs %}
                <tr>
                    <td>{{ entry.student.user.get_full_name }}</td>
                    <td>{{ entry.student.course.name }}</td>
                    {% for doc in entry.doc_status %}
                        <td>
                            {% if doc.uploaded %}
                                {% if doc.file|file_ext:'.jpg' or doc.file|file_ext:'.jpeg' or doc.file|file_ext:'.png' %}
                                    <a href="{{ doc.file }}" target="_blank">
                                        <img src="{{ doc.file }}" alt="Preview" style="max-width: 60px; max-height: 60px; border-radius: 4px; border: 1px solid #ddd; margin-bottom: 4px;">
                                    </a><br>
                                {% elif doc.file|file_ext:'.pdf' %}
                                    <a href="{{ doc.file }}" target="_blank">
                                        <embed src="{{ doc.file }}" type="application/pdf" width="60" height="60" style="border-radius: 4px; border: 1px solid #ddd; margin-bottom: 4px;" />
                                    </a><br>
                                {% elif doc.file|file_ext:'.xlsx' or doc.file|file_ext:'.xls' %}
                                    <span class="badge bg-success"><i class="bi bi-file-earmark-excel"></i> Excel</span><br>
                                {% endif %}
                                <a href="{{ doc.file }}" class="btn btn-sm btn-outline-secondary" target="_blank">Download</a>
                                <form method="post" action="{% url 'dashboard:coordinator_delete_student_document' entry.student.id doc.required.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-danger ms-1" onclick="return confirm('Are you sure you want to delete this document?');">Delete</button>
                                </form>
                            {% endif %}
                            <a href="{% url 'dashboard:coordinator_upload_student_document' entry.student.id doc.required.id %}" class="btn btn-sm btn-primary ms-1">Upload/Update</a>
                        </td>
                    {% endfor %}
                    <td style="min-width:120px;">
                        <div class="progress">
                            <div class="progress-bar bg-success" role="progressbar" style="width: {{ entry.progress }}%;" aria-valuenow="{{ entry.progress }}" aria-valuemin="0" aria-valuemax="100">{{ entry.progress }}%</div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
